<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QS Empire - Eng. Basel Omar</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0f;
            --card: #12121a;
            --card-hover: #1a1a25;
            --accent: #6366f1;
            --accent-glow: rgba(99, 102, 241, 0.3);
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --text: #ffffff;
            --text-dim: #9ca3af;
            --border: #2a2a3a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* === HEADER === */
        .header {
            background: linear-gradient(135deg, var(--card) 0%, #1a1a2e 100%);
            padding: 20px;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }

        .logo-text h1 {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .logo-text span {
            font-size: 0.8rem;
            color: var(--text-dim);
        }

        /* === FOCUS MODE TOGGLE === */
        .focus-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--card);
            padding: 8px 16px;
            border-radius: 25px;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.3s;
        }

        .focus-toggle:hover {
            border-color: var(--accent);
        }

        /* === AI AGENT PANEL === */
        .ai-toggle {
            position: fixed;
            bottom: 25px;
            left: 25px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 0 4px 20px var(--accent-glow);
            transition: all 0.3s;
        }

        .ai-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px var(--accent-glow);
        }

        .ai-toggle.active {
            background: var(--danger);
        }

        .ai-panel {
            position: fixed;
            bottom: 100px;
            left: 25px;
            width: 400px;
            max-width: calc(100vw - 50px);
            height: 500px;
            max-height: calc(100vh - 150px);
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 20px;
            display: none;
            flex-direction: column;
            overflow: hidden;
            z-index: 999;
            box-shadow: 0 10px 50px rgba(0,0,0,0.5);
        }

        .ai-panel.active {
            display: flex;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ai-header {
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .ai-header-icon {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .ai-header-info h3 {
            font-size: 1rem;
            font-weight: 600;
            margin: 0;
        }

        .ai-header-info span {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .ai-status {
            margin-right: auto;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
        }

        .ai-status-dot {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .ai-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ai-message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .ai-message.agent {
            background: var(--card-hover);
            border: 1px solid var(--border);
            align-self: flex-start;
            border-bottom-right-radius: 4px;
        }

        .ai-message.user {
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            align-self: flex-end;
            border-bottom-left-radius: 4px;
        }

        .ai-message.typing {
            background: var(--card-hover);
            border: 1px solid var(--border);
            align-self: flex-start;
        }

        .ai-message.typing::after {
            content: '...';
            animation: typing 1s infinite;
        }

        @keyframes typing {
            0%, 100% { content: '.'; }
            33% { content: '..'; }
            66% { content: '...'; }
        }

        .ai-input-area {
            padding: 15px;
            background: var(--bg);
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
        }

        .ai-input {
            flex: 1;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 16px;
            color: var(--text);
            font-size: 0.9rem;
            font-family: inherit;
            resize: none;
            outline: none;
        }

        .ai-input:focus {
            border-color: var(--accent);
        }

        .ai-send {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-send:hover {
            transform: scale(1.05);
        }

        .ai-send:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .ai-quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 10px 15px;
            background: var(--bg);
            border-top: 1px solid var(--border);
        }

        .ai-quick-btn {
            padding: 6px 12px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 20px;
            color: var(--text-dim);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .ai-quick-btn:hover {
            border-color: var(--accent);
            color: var(--text);
        }

        .focus-toggle.active {
            background: var(--accent);
            border-color: var(--accent);
        }

        /* === NAV TABS === */
        .nav-tabs {
            display: flex;
            gap: 8px;
            padding: 15px 20px;
            background: var(--card);
            overflow-x: auto;
            scrollbar-width: none;
        }

        .nav-tabs::-webkit-scrollbar {
            display: none;
        }

        .nav-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: transparent;
            border: 2px solid transparent;
            border-radius: 12px;
            color: var(--text-dim);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            font-family: inherit;
        }

        .nav-tab:hover {
            background: var(--card-hover);
            color: var(--text);
        }

        .nav-tab.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            box-shadow: 0 4px 15px var(--accent-glow);
        }

        .nav-tab .badge {
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }

        /* === MAIN CONTENT === */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* === QUICK ACTIONS === */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 25px;
        }

        .quick-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 20px 15px;
            background: var(--card);
            border: 2px solid var(--border);
            border-radius: 16px;
            color: var(--text);
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .quick-btn:hover {
            transform: translateY(-3px);
            border-color: var(--accent);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .quick-btn .icon {
            font-size: 2rem;
        }

        .quick-btn.primary {
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            border-color: transparent;
        }

        .quick-btn.primary:hover {
            box-shadow: 0 8px 25px var(--accent-glow);
        }

        /* === STATS CARDS === */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            border-color: var(--accent);
        }

        .stat-card .value {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-card .label {
            color: var(--text-dim);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* === CARDS LIST === */
        .cards-grid {
            display: grid;
            gap: 15px;
        }

        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .card:hover {
            border-color: var(--accent);
            transform: translateX(-5px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .card-meta {
            color: var(--text-dim);
            font-size: 0.85rem;
        }

        .card-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-new { background: var(--accent); color: white; }
        .badge-hot { background: var(--danger); color: white; }
        .badge-good { background: var(--success); color: white; }
        .badge-pending { background: var(--warning); color: #000; }
        .badge-progress { background: #3b82f6; color: white; }
        .badge-completed { background: var(--success); color: white; }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .card-price {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--success);
        }

        .card-actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: #5558e3;
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-dim);
            border: 1px solid var(--border);
        }

        .btn-ghost:hover {
            background: var(--card-hover);
            color: var(--text);
        }

        /* === SUCCESS RATE === */
        .success-rate {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rate-bar {
            flex: 1;
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
        }

        .rate-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .rate-fill.high { background: var(--success); }
        .rate-fill.medium { background: var(--warning); }
        .rate-fill.low { background: var(--danger); }

        .rate-text {
            font-weight: 600;
            min-width: 45px;
        }

        /* === PROJECTS SECTION === */
        .project-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s;
        }

        .project-card:hover {
            border-color: var(--accent);
        }

        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .project-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .project-client {
            color: var(--text-dim);
            font-size: 0.9rem;
            margin-top: 3px;
        }

        .project-progress {
            margin: 15px 0;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .progress-bar {
            height: 10px;
            background: var(--border);
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #8b5cf6);
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .project-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .project-detail {
            text-align: center;
        }

        .project-detail .value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--accent);
        }

        .project-detail .label {
            font-size: 0.75rem;
            color: var(--text-dim);
        }
        
        /* Project Card Enhanced */
        .project-card.overdue {
            border-color: var(--danger);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.2);
        }
        
        .overdue-banner {
            background: var(--danger);
            color: white;
            text-align: center;
            padding: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            margin: -20px -20px 15px -20px;
            border-radius: 16px 16px 0 0;
        }
        
        .project-source {
            font-size: 0.8rem;
            color: var(--accent);
            margin-top: 3px;
        }
        
        .project-timeline {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            padding: 12px;
            background: var(--bg);
            border-radius: 10px;
        }
        
        .timeline-item {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        
        .timeline-icon {
            font-size: 1.2rem;
        }
        
        .timeline-item .label {
            font-size: 0.75rem;
            color: var(--text-dim);
        }
        
        .timeline-item .value {
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .timeline-item .value.overdue-text {
            color: var(--danger);
        }
        
        .project-money {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
            padding: 12px;
            background: var(--bg);
            border-radius: 10px;
        }
        
        .money-item {
            text-align: center;
        }
        
        .money-item .label {
            font-size: 0.7rem;
            color: var(--text-dim);
        }
        
        .money-item .value {
            font-size: 0.95rem;
            font-weight: 600;
        }
        
        .money-item.paid .value {
            color: var(--success);
        }
        
        .money-item.pending .value {
            color: var(--warning);
        }
        
        .project-payment-status {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .payment-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .badge-good {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }
        
        .badge-partial {
            background: rgba(99, 102, 241, 0.2);
            color: var(--accent);
        }
        
        .badge-pending {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }
        
        .badge-progress {
            background: rgba(99, 102, 241, 0.2);
            color: var(--accent);
        }
        
        .badge-review {
            background: rgba(139, 92, 246, 0.2);
            color: #a78bfa;
        }
        
        /* Project Detail Modal */
        .project-detail-modal {
            display: grid;
            gap: 20px;
        }
        
        .detail-section {
            padding: 15px;
            background: var(--bg);
            border-radius: 10px;
        }
        
        .detail-section h4 {
            margin-bottom: 12px;
            color: var(--accent);
        }
        
        .detail-section p {
            margin: 8px 0;
            color: var(--text-dim);
        }
        
        .detail-section a {
            color: var(--accent);
            text-decoration: none;
        }
        
        .detail-section a:hover {
            text-decoration: underline;
        }

        /* === CALCULATOR === */
        .calc-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .calc-panel {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
        }

        .calc-panel h3 {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-dim);
            font-size: 0.9rem;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px 15px;
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .calc-result {
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-top: 20px;
        }

        .calc-result .total {
            font-size: 2rem;
            font-weight: 700;
        }

        .calc-result .label {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        /* === MODAL === */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--card);
            border-radius: 20px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .modal-header h2 {
            font-size: 1.3rem;
        }

        .modal-close {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--bg);
            border: none;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: var(--danger);
        }

        .modal-body {
            padding: 20px;
        }

        .proposal-box {
            background: var(--bg);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            white-space: pre-wrap;
            line-height: 1.8;
            max-height: 300px;
            overflow-y: auto;
        }

        .copy-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--success), #059669);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .copy-btn:hover {
            transform: scale(1.02);
        }

        /* === FOCUS MODE === */
        body.focus-mode .card:not(.highlighted),
        body.focus-mode .stat-card:not(.highlighted),
        body.focus-mode .project-card:not(.highlighted) {
            opacity: 0.3;
            filter: grayscale(50%);
        }

        body.focus-mode .card.highlighted,
        body.focus-mode .stat-card.highlighted,
        body.focus-mode .project-card.highlighted {
            border-color: var(--accent);
            box-shadow: 0 0 30px var(--accent-glow);
        }

        /* === EMPTY STATE === */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-dim);
        }

        .empty-state .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* === RESPONSIVE === */
        @media (max-width: 768px) {
            .header-content {
                justify-content: center;
                text-align: center;
            }

            .nav-tabs {
                justify-content: flex-start;
            }

            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }

            .stats-row {
                grid-template-columns: repeat(2, 1fr);
            }

            .project-details {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* === ADD FORM === */
        .add-form {
            display: none;
            background: var(--card);
            border: 2px dashed var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .add-form.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">ğŸ—ï¸</div>
                <div class="logo-text">
                    <h1>QS Empire</h1>
                    <span>Eng. Basel Omar</span>
                </div>
            </div>
            <div class="focus-toggle" onclick="toggleFocusMode()">
                <span>ğŸ¯</span>
                <span>Focus Mode</span>
            </div>
        </div>
    </header>

    <!-- NAVIGATION -->
    <nav class="nav-tabs">
        <button class="nav-tab active" data-section="dashboard">
            <span>ğŸ </span> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        </button>
        <button class="nav-tab" data-section="opportunities">
            <span>ğŸ¯</span> Ø§Ù„ÙØ±Øµ <span class="badge" id="opp-count">0</span>
        </button>
        <button class="nav-tab" data-section="projects">
            <span>ğŸ“</span> Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ <span class="badge" id="proj-count">0</span>
        </button>
        <button class="nav-tab" data-section="clients">
            <span>ğŸ‘¥</span> Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
        </button>
        <button class="nav-tab" data-section="calculator">
            <span>ğŸ§®</span> Ø§Ù„Ø­Ø§Ø³Ø¨Ø©
        </button>
        <button class="nav-tab" data-section="finance">
            <span>ğŸ’°</span> Ø§Ù„Ù…Ø§Ù„ÙŠØ©
        </button>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <!-- ========== DASHBOARD ========== -->
        <section id="dashboard" class="section active">
            <div class="quick-actions">
                <button class="quick-btn primary" onclick="switchSection('opportunities')">
                    <span class="icon">ğŸ¯</span>
                    Ø´ÙˆÙ Ø§Ù„ÙØ±Øµ
                </button>
                <button class="quick-btn" onclick="switchSection('projects'); showAddProject()">
                    <span class="icon">â•</span>
                    Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯
                </button>
                <button class="quick-btn" onclick="switchSection('calculator')">
                    <span class="icon">ğŸ§®</span>
                    Ø­Ø³Ø§Ø¨ ÙƒÙ…ÙŠØ§Øª
                </button>
                <button class="quick-btn" onclick="switchSection('finance')">
                    <span class="icon">ğŸ’µ</span>
                    Ø¯Ø®Ù„ Ø¬Ø¯ÙŠØ¯
                </button>
            </div>

            <div class="stats-row">
                <div class="stat-card highlighted">
                    <div class="value" id="stat-opportunities">0</div>
                    <div class="label">ÙØ±Øµ Ø¬Ø¯ÙŠØ¯Ø©</div>
                </div>
                <div class="stat-card">
                    <div class="value" id="stat-projects">0</div>
                    <div class="label">Ù…Ø´Ø§Ø±ÙŠØ¹ Ù†Ø´Ø·Ø©</div>
                </div>
                <div class="stat-card">
                    <div class="value" id="stat-clients">0</div>
                    <div class="label">Ø¹Ù…Ù„Ø§Ø¡</div>
                </div>
                <div class="stat-card">
                    <div class="value" id="stat-revenue">0</div>
                    <div class="label">Ø§Ù„Ø¯Ø®Ù„ (AED)</div>
                </div>
            </div>

            <h3 style="margin-bottom: 15px;">ğŸ”¥ Ø£Ø­Ø¯Ø« Ø§Ù„ÙØ±Øµ</h3>
            <div class="cards-grid" id="latest-opportunities"></div>
        </section>

        <!-- ========== OPPORTUNITIES ========== -->
        <section id="opportunities" class="section">
            <div class="stats-row">
                <div class="stat-card highlighted">
                    <div class="value" id="total-opps">0</div>
                    <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Øµ</div>
                </div>
                <div class="stat-card">
                    <div class="value" id="high-success">0</div>
                    <div class="label">Ù†Ø³Ø¨Ø© Ù†Ø¬Ø§Ø­ Ø¹Ø§Ù„ÙŠØ©</div>
                </div>
            </div>

            <div class="cards-grid" id="opportunities-list"></div>
        </section>

        <!-- ========== PROJECTS ========== -->
        <section id="projects" class="section">
            <div class="quick-actions" style="margin-bottom: 20px;">
                <button class="quick-btn primary" onclick="showAddProject()">
                    <span class="icon">â•</span>
                    Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯
                </button>
                <button class="quick-btn" onclick="filterProjects('all')">
                    <span class="icon">ğŸ“‹</span>
                    Ø§Ù„ÙƒÙ„
                </button>
                <button class="quick-btn" onclick="filterProjects('pending-payment')">
                    <span class="icon">ğŸ’³</span>
                    ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¯ÙØ¹
                </button>
                <button class="quick-btn" onclick="filterProjects('overdue')">
                    <span class="icon">âš ï¸</span>
                    Ù…ØªØ£Ø®Ø±Ø©
                </button>
            </div>

            <!-- Add Project Form -->
            <div class="add-form" id="add-project-form">
                <h3 style="margin-bottom: 20px;">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</h3>
                <div class="form-row">
                    <div class="input-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ *</label>
                        <input type="text" id="project-name" placeholder="Ù…Ø«Ø§Ù„: ÙÙŠÙ„Ø§ Ø§Ù„Ø³ÙŠØ¯ Ø£Ø­Ù…Ø¯ - Ø§Ù„Ø´Ø§Ø±Ù‚Ø©">
                    </div>
                    <div class="input-group">
                        <label>Ø§Ù„Ø¹Ù…ÙŠÙ„ *</label>
                        <input type="text" id="project-client" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø´Ø±ÙƒØ©">
                    </div>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label>Ù‡Ø§ØªÙ Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                        <input type="tel" id="project-client-phone" placeholder="+971 50 XXX XXXX">
                    </div>
                    <div class="input-group">
                        <label>Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                        <input type="email" id="project-client-email" placeholder="email@example.com">
                    </div>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                        <select id="project-type">
                            <option value="BOQ">BOQ Ø­ØµØ± ÙƒÙ…ÙŠØ§Øª</option>
                            <option value="ØªØ³Ø¹ÙŠØ±">ØªØ³Ø¹ÙŠØ± Ù…Ù‚Ø§ÙˆÙ„Ø§Øª</option>
                            <option value="ÙÙŠÙ„Ø§">ÙÙŠÙ„Ø§</option>
                            <option value="Ù…Ø¨Ù†Ù‰ Ø³ÙƒÙ†ÙŠ">Ù…Ø¨Ù†Ù‰ Ø³ÙƒÙ†ÙŠ</option>
                            <option value="ØªØ¬Ø§Ø±ÙŠ">ØªØ¬Ø§Ø±ÙŠ</option>
                            <option value="Ø¨Ø±Ø¬">Ø¨Ø±Ø¬</option>
                            <option value="ØªØ¬Ø¯ÙŠØ¯">ØªØ¬Ø¯ÙŠØ¯</option>
                            <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Ø§Ù„Ù…Ù†ØµØ©/Ø§Ù„Ù…ØµØ¯Ø±</label>
                        <select id="project-source">
                            <option value="Upwork">Upwork</option>
                            <option value="Freelancer">Freelancer</option>
                            <option value="Mostaql">Ù…Ø³ØªÙ‚Ù„</option>
                            <option value="Fiverr">Fiverr</option>
                            <option value="LinkedIn">LinkedIn</option>
                            <option value="Direct">Ù…Ø¨Ø§Ø´Ø±</option>
                            <option value="Referral">Ø¥Ø­Ø§Ù„Ø©</option>
                            <option value="Other">Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© (AED) *</label>
                        <input type="number" id="project-value" placeholder="0">
                    </div>
                    <div class="input-group">
                        <label>Ø§Ù„Ù…Ø¯ÙÙˆØ¹ (AED)</label>
                        <input type="number" id="project-paid" placeholder="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
                        <input type="date" id="project-start">
                    </div>
                    <div class="input-group">
                        <label>â° Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ… *</label>
                        <input type="date" id="project-deadline">
                    </div>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label>ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… ÙÙŠ</label>
                        <input type="date" id="project-delivered">
                    </div>
                    <div class="input-group">
                        <label>Ø§Ù„Ø­Ø§Ù„Ø©</label>
                        <select id="project-status">
                            <option value="Ø¬Ø¯ÙŠØ¯">Ø¬Ø¯ÙŠØ¯</option>
                            <option value="Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option>
                            <option value="ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                            <option value="ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
                            <option value="Ù…Ø¹Ù„Ù‚">Ù…Ø¹Ù„Ù‚</option>
                            <option value="Ù…Ù„ØºÙŠ">Ù…Ù„ØºÙŠ</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label>ğŸ’³ Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</label>
                        <select id="project-payment">
                            <option value="ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹">ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹</option>
                            <option value="Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø©">Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø©</option>
                            <option value="Ø¬Ø²Ø¦ÙŠ">Ù…Ø¯ÙÙˆØ¹ Ø¬Ø²Ø¦ÙŠØ§Ù‹</option>
                            <option value="Ù…Ø¯ÙÙˆØ¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„">Ù…Ø¯ÙÙˆØ¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ âœ…</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² %</label>
                        <input type="range" id="project-progress" min="0" max="100" value="0" oninput="document.getElementById('progress-value').textContent = this.value + '%'">
                        <span id="progress-value" style="color: var(--accent); font-weight: bold;">0%</span>
                    </div>
                </div>
                <div class="input-group">
                    <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                    <textarea id="project-notes" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..." rows="2" style="width:100%; padding:12px; background:var(--bg); border:1px solid var(--border); border-radius:8px; color:var(--text); resize:vertical;"></textarea>
                </div>
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="addProject()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>
                    <button class="btn btn-ghost" onclick="hideAddProject()">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>

            <div class="stats-row">
                <div class="stat-card">
                    <div class="value" id="active-projects">0</div>
                    <div class="label">Ù…Ø´Ø§Ø±ÙŠØ¹ Ù†Ø´Ø·Ø©</div>
                </div>
                <div class="stat-card">
                    <div class="value" id="completed-projects">0</div>
                    <div class="label">ØªÙ… ØªØ³Ù„ÙŠÙ…Ù‡Ø§</div>
                </div>
                <div class="stat-card" style="border-color: var(--success);">
                    <div class="value" style="color: var(--success);" id="total-paid">0</div>
                    <div class="label">Ø§Ù„Ù…Ø­ØµÙ‘Ù„ (AED)</div>
                </div>
                <div class="stat-card" style="border-color: var(--warning);">
                    <div class="value" style="color: var(--warning);" id="total-pending">0</div>
                    <div class="label">ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± (AED)</div>
                </div>
            </div>

            <div class="cards-grid" id="projects-list"></div>
        </section>

        <!-- ========== CLIENTS ========== -->
        <section id="clients" class="section">
            <div class="quick-actions" style="margin-bottom: 20px;">
                <button class="quick-btn primary" onclick="showAddClient()">
                    <span class="icon">â•</span>
                    Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
                </button>
            </div>

            <div class="add-form" id="add-client-form">
                <h3 style="margin-bottom: 20px;">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h3>
                <div class="form-row">
                    <div class="input-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                        <input type="text" id="client-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
                    </div>
                    <div class="input-group">
                        <label>Ø§Ù„Ø´Ø±ÙƒØ©</label>
                        <input type="text" id="client-company" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                    </div>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label>Ø§Ù„Ù‡Ø§ØªÙ</label>
                        <input type="tel" id="client-phone" placeholder="+971 50 XXX XXXX">
                    </div>
                    <div class="input-group">
                        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" id="client-email" placeholder="email@example.com">
                    </div>
                </div>
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="addClient()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
                    <button class="btn btn-ghost" onclick="hideAddClient()">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>

            <div class="cards-grid" id="clients-list"></div>
        </section>

        <!-- ========== CALCULATOR ========== -->
        <section id="calculator" class="section">
            <div class="calc-container">
                <div class="calc-panel">
                    <h3>ğŸ§® Ø­Ø³Ø§Ø¨ Ø³Ø±ÙŠØ¹</h3>
                    <div class="input-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„</label>
                        <select id="calc-type" onchange="updateCalc()">
                            <option value="excavation">Ø­ÙØ±</option>
                            <option value="concrete">Ø®Ø±Ø³Ø§Ù†Ø©</option>
                            <option value="blocks">Ø¨Ù„ÙˆÙƒ</option>
                            <option value="plaster">Ù„ÙŠØ§Ø³Ø©</option>
                            <option value="tiles">Ø¨Ù„Ø§Ø·</option>
                            <option value="paint">Ø¯Ù‡Ø§Ù†</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="input-group">
                            <label>Ø§Ù„Ø·ÙˆÙ„ (Ù…)</label>
                            <input type="number" id="calc-length" value="10" onchange="updateCalc()">
                        </div>
                        <div class="input-group">
                            <label>Ø§Ù„Ø¹Ø±Ø¶ (Ù…)</label>
                            <input type="number" id="calc-width" value="10" onchange="updateCalc()">
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Ø§Ù„Ø¹Ù…Ù‚/Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ (Ù…)</label>
                        <input type="number" id="calc-height" value="3" onchange="updateCalc()">
                    </div>
                    <div class="calc-result">
                        <div class="label">Ø§Ù„ÙƒÙ…ÙŠØ©</div>
                        <div class="total" id="calc-quantity">300 Ù…Â³</div>
                    </div>
                    <div class="calc-result" style="margin-top: 10px; background: var(--success);">
                        <div class="label">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©</div>
                        <div class="total" id="calc-cost">15,000 AED</div>
                    </div>
                </div>

                <div class="calc-panel">
                    <h3>ğŸ“Š ØªÙ‚Ø¯ÙŠØ± Ù…Ø´Ø±ÙˆØ¹ ÙƒØ§Ù…Ù„</h3>
                    <div class="input-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                        <select id="proj-type" onchange="updateProjectEstimate()">
                            <option value="villa">ÙÙŠÙ„Ø§</option>
                            <option value="building">Ù…Ø¨Ù†Ù‰ Ø³ÙƒÙ†ÙŠ</option>
                            <option value="commercial">ØªØ¬Ø§Ø±ÙŠ</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© (Ù…Â²)</label>
                        <input type="number" id="proj-area" value="500" onchange="updateProjectEstimate()">
                    </div>
                    <div class="input-group">
                        <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ´Ø·ÙŠØ¨</label>
                        <select id="proj-finish" onchange="updateProjectEstimate()">
                            <option value="standard">Ø¹Ø§Ø¯ÙŠ</option>
                            <option value="luxury">ÙØ§Ø®Ø±</option>
                            <option value="super">Ø³ÙˆØ¨Ø± Ù„ÙˆÙƒØ³</option>
                        </select>
                    </div>
                    <div class="calc-result">
                        <div class="label">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©</div>
                        <div class="total" id="proj-estimate">750,000 AED</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ========== FINANCE ========== -->
        <section id="finance" class="section">
            <div class="quick-actions" style="margin-bottom: 20px;">
                <button class="quick-btn primary" onclick="showAddIncome()">
                    <span class="icon">ğŸ’µ</span>
                    Ø¥Ø¶Ø§ÙØ© Ø¯Ø®Ù„
                </button>
                <button class="quick-btn" onclick="showAddExpense()">
                    <span class="icon">ğŸ“¤</span>
                    Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ
                </button>
            </div>

            <div class="add-form" id="add-income-form">
                <h3 style="margin-bottom: 20px;">ğŸ’µ Ø¥Ø¶Ø§ÙØ© Ø¯Ø®Ù„</h3>
                <div class="form-row">
                    <div class="input-group">
                        <label>Ø§Ù„ÙˆØµÙ</label>
                        <input type="text" id="income-desc" placeholder="Ù…Ø«Ø§Ù„: Ø¯ÙØ¹Ø© Ù…Ø´Ø±ÙˆØ¹ ÙÙŠÙ„Ø§">
                    </div>
                    <div class="input-group">
                        <label>Ø§Ù„Ù…Ø¨Ù„Øº (AED)</label>
                        <input type="number" id="income-amount" placeholder="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" id="income-date">
                    </div>
                    <div class="input-group">
                        <label>Ø§Ù„Ø¹Ù…ÙŠÙ„/Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                        <input type="text" id="income-source" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ">
                    </div>
                </div>
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="addIncome()">ğŸ’¾ Ø­ÙØ¸</button>
                    <button class="btn btn-ghost" onclick="hideAddIncome()">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>

            <div class="add-form" id="add-expense-form">
                <h3 style="margin-bottom: 20px;">ğŸ“¤ Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ</h3>
                <div class="form-row">
                    <div class="input-group">
                        <label>Ø§Ù„ÙˆØµÙ</label>
                        <input type="text" id="expense-desc" placeholder="Ù…Ø«Ø§Ù„: Ø§Ø´ØªØ±Ø§Ùƒ Upwork">
                    </div>
                    <div class="input-group">
                        <label>Ø§Ù„Ù…Ø¨Ù„Øº (AED)</label>
                        <input type="number" id="expense-amount" placeholder="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" id="expense-date">
                    </div>
                    <div class="input-group">
                        <label>Ø§Ù„ÙØ¦Ø©</label>
                        <select id="expense-category">
                            <option value="subscriptions">Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</option>
                            <option value="software">Ø¨Ø±Ø§Ù…Ø¬</option>
                            <option value="transport">Ù…ÙˆØ§ØµÙ„Ø§Øª</option>
                            <option value="other">Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                </div>
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="addExpense()">ğŸ’¾ Ø­ÙØ¸</button>
                    <button class="btn btn-ghost" onclick="hideAddExpense()">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>

            <div class="stats-row">
                <div class="stat-card" style="border-color: var(--success);">
                    <div class="value" style="color: var(--success);" id="total-income">0</div>
                    <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„</div>
                </div>
                <div class="stat-card" style="border-color: var(--danger);">
                    <div class="value" style="color: var(--danger);" id="total-expenses">0</div>
                    <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
                </div>
                <div class="stat-card" style="border-color: var(--accent);">
                    <div class="value" id="net-profit">0</div>
                    <div class="label">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</div>
                </div>
            </div>

            <h3 style="margin: 20px 0 15px;">ğŸ“‹ Ø¢Ø®Ø± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h3>
            <div class="cards-grid" id="transactions-list"></div>
        </section>
    </main>

    <!-- MODAL -->
    <div class="modal-overlay" id="modal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modal-title">ØªÙØ§ØµÙŠÙ„</h2>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
        </div>
    </div>

    <script>
        // ===== DATA STORE =====
        let data = {
            opportunities: [],
            projects: [],
            clients: [],
            income: [],
            expenses: []
        };

        // Load from localStorage
        function loadData() {
            const saved = localStorage.getItem('qs_empire_data');
            if (saved) {
                data = JSON.parse(saved);
            }
            // Also try to load opportunities from data.json
            fetch('data.json')
                .then(r => r.json())
                .then(json => {
                    if (json.opportunities && json.opportunities.length > 0) {
                        // Merge with existing, avoiding duplicates
                        json.opportunities.forEach(opp => {
                            if (!data.opportunities.find(o => o.id === opp.id)) {
                                data.opportunities.push(opp);
                            }
                        });
                        saveData();
                    }
                    renderAll();
                })
                .catch(() => renderAll());
        }

        function saveData() {
            localStorage.setItem('qs_empire_data', JSON.stringify(data));
        }

        // ===== NAVIGATION =====
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const section = tab.dataset.section;
                switchSection(section);
            });
        });

        function switchSection(sectionId) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            
            document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');
            document.getElementById(sectionId).classList.add('active');
        }

        // ===== FOCUS MODE =====
        function toggleFocusMode() {
            document.body.classList.toggle('focus-mode');
            document.querySelector('.focus-toggle').classList.toggle('active');
        }

        // ===== RENDER FUNCTIONS =====
        function renderAll() {
            renderStats();
            renderOpportunities();
            renderProjects();
            renderClients();
            renderFinance();
        }

        function renderStats() {
            document.getElementById('stat-opportunities').textContent = data.opportunities.length;
            document.getElementById('stat-projects').textContent = data.projects.filter(p => p.status === 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°').length;
            document.getElementById('stat-clients').textContent = data.clients.length;
            
            const totalIncome = data.income.reduce((sum, i) => sum + (parseFloat(i.amount) || 0), 0);
            document.getElementById('stat-revenue').textContent = totalIncome.toLocaleString();

            document.getElementById('opp-count').textContent = data.opportunities.length;
            document.getElementById('proj-count').textContent = data.projects.length;
        }

        function renderOpportunities() {
            const container = document.getElementById('opportunities-list');
            const latestContainer = document.getElementById('latest-opportunities');
            
            document.getElementById('total-opps').textContent = data.opportunities.length;
            document.getElementById('high-success').textContent = data.opportunities.filter(o => o.successRate >= 70).length;

            if (data.opportunities.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ¯</div>
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ±Øµ Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
                        <p>Ø§Ù„ÙØ±Øµ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
                    </div>
                `;
                latestContainer.innerHTML = container.innerHTML;
                return;
            }

            const renderCard = (opp) => `
                <div class="card ${opp.successRate >= 70 ? 'highlighted' : ''}" onclick="showOpportunity('${opp.id}')">
                    <div class="card-header">
                        <div>
                            <div class="card-title">${opp.title}</div>
                            <div class="card-meta">${opp.platform} â€¢ ${opp.date || 'Ø§Ù„ÙŠÙˆÙ…'}</div>
                        </div>
                        <span class="card-badge ${opp.successRate >= 70 ? 'badge-hot' : 'badge-new'}">
                            ${opp.successRate >= 70 ? 'ğŸ”¥ ÙØ±ØµØ© Ù‚ÙˆÙŠØ©' : 'âœ¨ Ø¬Ø¯ÙŠØ¯'}
                        </span>
                    </div>
                    <div class="success-rate">
                        <span>Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­:</span>
                        <div class="rate-bar">
                            <div class="rate-fill ${opp.successRate >= 70 ? 'high' : opp.successRate >= 50 ? 'medium' : 'low'}" 
                                 style="width: ${opp.successRate}%"></div>
                        </div>
                        <span class="rate-text">${opp.successRate}%</span>
                    </div>
                    <div class="card-footer">
                        <span class="card-price">${opp.budget}</span>
                        <div class="card-actions">
                            <button class="btn btn-primary" onclick="event.stopPropagation(); showOpportunity('${opp.id}')">
                                ğŸ“‹ Proposal
                            </button>
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = data.opportunities.map(renderCard).join('');
            latestContainer.innerHTML = data.opportunities.slice(0, 3).map(renderCard).join('');
        }

        let projectFilter = 'all';
        
        function filterProjects(filter) {
            projectFilter = filter;
            renderProjects();
        }
        
        function renderProjects() {
            const container = document.getElementById('projects-list');
            
            // Stats
            const active = data.projects.filter(p => ['Ø¬Ø¯ÙŠØ¯', 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°', 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'].includes(p.status)).length;
            const completed = data.projects.filter(p => p.status === 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…').length;
            const totalPaid = data.projects.reduce((sum, p) => sum + (parseFloat(p.paid) || 0), 0);
            const totalValue = data.projects.reduce((sum, p) => sum + (parseFloat(p.value) || 0), 0);
            const totalPending = totalValue - totalPaid;

            document.getElementById('active-projects').textContent = active;
            document.getElementById('completed-projects').textContent = completed;
            document.getElementById('total-paid').textContent = totalPaid.toLocaleString();
            document.getElementById('total-pending').textContent = totalPending.toLocaleString();

            if (data.projects.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ“</div>
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹</h3>
                        <p>Ø£Ø¶Ù Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„Ø£ÙˆÙ„</p>
                    </div>
                `;
                return;
            }
            
            // Filter projects
            let filtered = data.projects;
            const today = new Date().toISOString().split('T')[0];
            
            if (projectFilter === 'pending-payment') {
                filtered = data.projects.filter(p => p.payment !== 'Ù…Ø¯ÙÙˆØ¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„');
            } else if (projectFilter === 'overdue') {
                filtered = data.projects.filter(p => p.deadline && p.deadline < today && p.status !== 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…' && p.status !== 'Ù…Ù„ØºÙŠ');
            }

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">âœ¨</div>
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</h3>
                        <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ ØªØ·Ø§Ø¨Ù‚ Ø§Ù„ÙÙ„ØªØ±</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(proj => {
                const progress = proj.progress || 0;
                const isOverdue = proj.deadline && proj.deadline < today && proj.status !== 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…' && proj.status !== 'Ù…Ù„ØºÙŠ';
                const remaining = (parseFloat(proj.value) || 0) - (parseFloat(proj.paid) || 0);
                
                // Status badge color
                let statusClass = 'badge-new';
                if (proj.status === 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…') statusClass = 'badge-good';
                else if (proj.status === 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°') statusClass = 'badge-progress';
                else if (proj.status === 'Ù…Ø¹Ù„Ù‚' || proj.status === 'Ù…Ù„ØºÙŠ') statusClass = 'badge-pending';
                else if (proj.status === 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©') statusClass = 'badge-review';
                
                // Payment badge
                let paymentClass = 'badge-pending';
                let paymentIcon = 'â³';
                if (proj.payment === 'Ù…Ø¯ÙÙˆØ¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„') { paymentClass = 'badge-good'; paymentIcon = 'âœ…'; }
                else if (proj.payment === 'Ø¬Ø²Ø¦ÙŠ' || proj.payment === 'Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø©') { paymentClass = 'badge-partial'; paymentIcon = 'ğŸ’³'; }
                else { paymentClass = 'badge-pending'; paymentIcon = 'âš ï¸'; }
                
                return `
                    <div class="project-card ${isOverdue ? 'overdue' : ''}" onclick="showProjectDetails('${proj.id}')">
                        ${isOverdue ? '<div class="overdue-banner">âš ï¸ Ù…ØªØ£Ø®Ø± Ø¹Ù† Ø§Ù„Ù…ÙˆØ¹Ø¯</div>' : ''}
                        <div class="project-header">
                            <div>
                                <div class="project-title">${proj.name}</div>
                                <div class="project-client">ğŸ‘¤ ${proj.client || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                ${proj.source ? `<div class="project-source">ğŸ“ ${proj.source}</div>` : ''}
                            </div>
                            <span class="card-badge ${statusClass}">${proj.status || 'Ø¬Ø¯ÙŠØ¯'}</span>
                        </div>
                        
                        <div class="project-progress">
                            <div class="progress-header">
                                <span>Ø§Ù„ØªÙ‚Ø¯Ù…</span>
                                <span>${progress}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                        </div>
                        
                        <div class="project-timeline">
                            <div class="timeline-item">
                                <span class="timeline-icon">ğŸ“…</span>
                                <div>
                                    <div class="label">Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…</div>
                                    <div class="value ${isOverdue ? 'overdue-text' : ''}">${proj.deadline || '-'}</div>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <span class="timeline-icon">âœ…</span>
                                <div>
                                    <div class="label">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</div>
                                    <div class="value">${proj.delivered || '-'}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="project-money">
                            <div class="money-item">
                                <div class="label">Ø§Ù„Ù‚ÙŠÙ…Ø©</div>
                                <div class="value">${parseFloat(proj.value || 0).toLocaleString()} AED</div>
                            </div>
                            <div class="money-item paid">
                                <div class="label">Ø§Ù„Ù…Ø¯ÙÙˆØ¹</div>
                                <div class="value">${parseFloat(proj.paid || 0).toLocaleString()} AED</div>
                            </div>
                            <div class="money-item ${remaining > 0 ? 'pending' : 'paid'}">
                                <div class="label">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
                                <div class="value">${remaining.toLocaleString()} AED</div>
                            </div>
                        </div>
                        
                        <div class="project-payment-status">
                            <span class="payment-badge ${paymentClass}">${paymentIcon} ${proj.payment || 'ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹'}</span>
                        </div>
                        
                        <div class="card-footer">
                            <button class="btn btn-ghost" onclick="event.stopPropagation(); deleteProject('${proj.id}')">ğŸ—‘ï¸</button>
                            <button class="btn btn-ghost" onclick="event.stopPropagation(); editProject('${proj.id}')">âœï¸</button>
                            <button class="btn btn-primary" onclick="event.stopPropagation(); recordPayment('${proj.id}')">ğŸ’µ ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹Ø©</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function showProjectDetails(id) {
            const proj = data.projects.find(p => p.id === id);
            if (!proj) return;
            
            const remaining = (parseFloat(proj.value) || 0) - (parseFloat(proj.paid) || 0);
            
            document.getElementById('modal-title').textContent = proj.name;
            document.getElementById('modal-body').innerHTML = `
                <div class="project-detail-modal">
                    <div class="detail-section">
                        <h4>ğŸ‘¤ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h4>
                        <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${proj.client || '-'}</p>
                        <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${proj.clientPhone ? `<a href="tel:${proj.clientPhone}">${proj.clientPhone}</a>` : '-'}</p>
                        <p><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> ${proj.clientEmail ? `<a href="mailto:${proj.clientEmail}">${proj.clientEmail}</a>` : '-'}</p>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h4>
                        <p><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${proj.type || '-'}</p>
                        <p><strong>Ø§Ù„Ù…ØµØ¯Ø±:</strong> ${proj.source || '-'}</p>
                        <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${proj.status || '-'}</p>
                        <p><strong>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²:</strong> ${proj.progress || 0}%</p>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ“… Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</h4>
                        <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:</strong> ${proj.startDate || '-'}</p>
                        <p><strong>Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…:</strong> ${proj.deadline || '-'}</p>
                        <p><strong>ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… ÙÙŠ:</strong> ${proj.delivered || '-'}</p>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ’° Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h4>
                        <p><strong>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:</strong> ${parseFloat(proj.value || 0).toLocaleString()} AED</p>
                        <p><strong>Ø§Ù„Ù…Ø¯ÙÙˆØ¹:</strong> <span style="color: var(--success)">${parseFloat(proj.paid || 0).toLocaleString()} AED</span></p>
                        <p><strong>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</strong> <span style="color: ${remaining > 0 ? 'var(--warning)' : 'var(--success)'}">${remaining.toLocaleString()} AED</span></p>
                        <p><strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹:</strong> ${proj.payment || 'ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹'}</p>
                    </div>
                    ${proj.notes ? `<div class="detail-section"><h4>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h4><p>${proj.notes}</p></div>` : ''}
                </div>
            `;
            document.getElementById('modal').classList.add('active');
        }
        
        function editProject(id) {
            const proj = data.projects.find(p => p.id === id);
            if (!proj) return;
            
            // Fill form with project data
            document.getElementById('project-name').value = proj.name || '';
            document.getElementById('project-client').value = proj.client || '';
            document.getElementById('project-client-phone').value = proj.clientPhone || '';
            document.getElementById('project-client-email').value = proj.clientEmail || '';
            document.getElementById('project-type').value = proj.type || 'BOQ';
            document.getElementById('project-source').value = proj.source || 'Direct';
            document.getElementById('project-value').value = proj.value || '';
            document.getElementById('project-paid').value = proj.paid || '';
            document.getElementById('project-start').value = proj.startDate || '';
            document.getElementById('project-deadline').value = proj.deadline || '';
            document.getElementById('project-delivered').value = proj.delivered || '';
            document.getElementById('project-status').value = proj.status || 'Ø¬Ø¯ÙŠØ¯';
            document.getElementById('project-payment').value = proj.payment || 'ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹';
            document.getElementById('project-progress').value = proj.progress || 0;
            document.getElementById('progress-value').textContent = (proj.progress || 0) + '%';
            document.getElementById('project-notes').value = proj.notes || '';
            
            // Mark as editing
            document.getElementById('add-project-form').dataset.editId = id;
            showAddProject();
        }
        
        function recordPayment(id) {
            const proj = data.projects.find(p => p.id === id);
            if (!proj) return;
            
            const remaining = (parseFloat(proj.value) || 0) - (parseFloat(proj.paid) || 0);
            const amount = prompt(`ğŸ’µ Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙØ¹Ø© (Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${remaining.toLocaleString()} AED):`, remaining);
            
            if (amount !== null && !isNaN(amount) && parseFloat(amount) > 0) {
                proj.paid = (parseFloat(proj.paid) || 0) + parseFloat(amount);
                
                // Auto update payment status
                if (proj.paid >= proj.value) {
                    proj.payment = 'Ù…Ø¯ÙÙˆØ¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„';
                } else if (proj.paid > 0) {
                    proj.payment = 'Ø¬Ø²Ø¦ÙŠ';
                }
                
                // Add to income
                data.income.push({
                    id: 'inc_' + Date.now(),
                    desc: `Ø¯ÙØ¹Ø© Ù…Ù† Ù…Ø´Ø±ÙˆØ¹: ${proj.name}`,
                    amount: parseFloat(amount),
                    date: new Date().toISOString().split('T')[0],
                    source: proj.client
                });
                
                saveData();
                renderProjects();
                renderFinance();
                showAchievement('ğŸ’µ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø©!');
            }
        }

        function renderClients() {
            const container = document.getElementById('clients-list');

            if (data.clients.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ‘¥</div>
                        <h3>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡</h3>
                        <p>Ø£Ø¶Ù Ø¹Ù…ÙŠÙ„Ùƒ Ø§Ù„Ø£ÙˆÙ„</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = data.clients.map(client => `
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">${client.name}</div>
                            <div class="card-meta">${client.company || 'ÙØ±Ø¯ÙŠ'}</div>
                        </div>
                    </div>
                    <div style="color: var(--text-dim); font-size: 0.9rem;">
                        ${client.phone ? `ğŸ“± ${client.phone}` : ''}
                        ${client.email ? `<br>ğŸ“§ ${client.email}` : ''}
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-ghost" onclick="deleteClient('${client.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    </div>
                </div>
            `).join('');
        }

        function renderFinance() {
            const totalIncome = data.income.reduce((sum, i) => sum + (parseFloat(i.amount) || 0), 0);
            const totalExpenses = data.expenses.reduce((sum, e) => sum + (parseFloat(e.amount) || 0), 0);
            const netProfit = totalIncome - totalExpenses;

            document.getElementById('total-income').textContent = totalIncome.toLocaleString() + ' AED';
            document.getElementById('total-expenses').textContent = totalExpenses.toLocaleString() + ' AED';
            document.getElementById('net-profit').textContent = netProfit.toLocaleString() + ' AED';

            const container = document.getElementById('transactions-list');
            
            const transactions = [
                ...data.income.map(i => ({...i, type: 'income'})),
                ...data.expenses.map(e => ({...e, type: 'expense'}))
            ].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 10);

            if (transactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ’°</div>
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h3>
                        <p>Ø£Ø¶Ù Ø¯Ø®Ù„ Ø£Ùˆ Ù…ØµØ±ÙˆÙ</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = transactions.map(t => `
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">${t.desc}</div>
                            <div class="card-meta">${t.date || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                        </div>
                        <span class="card-badge ${t.type === 'income' ? 'badge-good' : 'badge-hot'}">
                            ${t.type === 'income' ? 'ğŸ’µ Ø¯Ø®Ù„' : 'ğŸ“¤ Ù…ØµØ±ÙˆÙ'}
                        </span>
                    </div>
                    <div class="card-price" style="color: ${t.type === 'income' ? 'var(--success)' : 'var(--danger)'}">
                        ${t.type === 'income' ? '+' : '-'}${parseFloat(t.amount).toLocaleString()} AED
                    </div>
                </div>
            `).join('');
        }

        // ===== OPPORTUNITY MODAL =====
        function showOpportunity(id) {
            const opp = data.opportunities.find(o => o.id === id);
            if (!opp) return;

            document.getElementById('modal-title').textContent = opp.title;
            document.getElementById('modal-body').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
                        <span class="card-badge badge-new">${opp.platform}</span>
                        <span class="card-badge badge-good">${opp.budget}</span>
                        <span class="card-badge ${opp.successRate >= 70 ? 'badge-hot' : 'badge-pending'}">
                            Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­: ${opp.successRate}%
                        </span>
                    </div>
                    ${opp.link ? `<a href="${opp.link}" target="_blank" class="btn btn-ghost" style="display: inline-block; margin-bottom: 15px;">ğŸ”— ÙØªØ­ Ø§Ù„ÙØ±ØµØ©</a>` : ''}
                </div>
                
                <h4 style="margin-bottom: 10px;">ğŸ“‹ Proposal Ø¬Ø§Ù‡Ø² Ù„Ù„Ù†Ø³Ø®:</h4>
                <div class="proposal-box">${opp.proposal || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ proposal Ù…ØªØ§Ø­'}</div>
                
                <button class="copy-btn" onclick="copyProposal('${id}')">
                    ğŸ“‹ Ù†Ø³Ø® Proposal
                </button>

                ${opp.warnings ? `
                    <div style="margin-top: 20px; padding: 15px; background: rgba(239, 68, 68, 0.1); border-radius: 10px; border: 1px solid var(--danger);">
                        <strong>âš ï¸ ØªØ­Ø°ÙŠØ±Ø§Øª:</strong><br>
                        ${opp.warnings}
                    </div>
                ` : ''}
            `;
            document.getElementById('modal').classList.add('active');
        }

        function copyProposal(id) {
            const opp = data.opportunities.find(o => o.id === id);
            if (opp && opp.proposal) {
                navigator.clipboard.writeText(opp.proposal);
                const btn = document.querySelector('.copy-btn');
                btn.textContent = 'âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®!';
                setTimeout(() => btn.textContent = 'ğŸ“‹ Ù†Ø³Ø® Proposal', 2000);
            }
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        // ===== PROJECT FUNCTIONS =====
        function showAddProject() {
            document.getElementById('add-project-form').classList.add('active');
        }

        function hideAddProject() {
            document.getElementById('add-project-form').classList.remove('active');
        }

        function addProject() {
            const project = {
                id: 'proj_' + Date.now(),
                name: document.getElementById('project-name').value,
                client: document.getElementById('project-client').value,
                type: document.getElementById('project-type').value,
                value: document.getElementById('project-value').value,
                startDate: document.getElementById('project-start').value,
                endDate: document.getElementById('project-end').value,
                status: document.getElementById('project-status').value,
                progress: 0
            };

            if (!project.name) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹');
                return;
            }

            data.projects.push(project);
            saveData();
            renderAll();
            hideAddProject();

            // Clear form
            document.getElementById('project-name').value = '';
            document.getElementById('project-client').value = '';
            document.getElementById('project-value').value = '';
        }

        function deleteProject(id) {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŸ')) {
                data.projects = data.projects.filter(p => p.id !== id);
                saveData();
                renderAll();
            }
        }

        function updateProjectProgress(id) {
            const newProgress = prompt('Ø£Ø¯Ø®Ù„ Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (0-100):');
            if (newProgress !== null) {
                const proj = data.projects.find(p => p.id === id);
                if (proj) {
                    proj.progress = Math.min(100, Math.max(0, parseInt(newProgress) || 0));
                    if (proj.progress === 100) proj.status = 'Ù…ÙƒØªÙ…Ù„';
                    saveData();
                    renderAll();
                }
            }
        }

        // ===== CLIENT FUNCTIONS =====
        function showAddClient() {
            document.getElementById('add-client-form').classList.add('active');
        }

        function hideAddClient() {
            document.getElementById('add-client-form').classList.remove('active');
        }

        function addClient() {
            const client = {
                id: 'client_' + Date.now(),
                name: document.getElementById('client-name').value,
                company: document.getElementById('client-company').value,
                phone: document.getElementById('client-phone').value,
                email: document.getElementById('client-email').value
            };

            if (!client.name) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„');
                return;
            }

            data.clients.push(client);
            saveData();
            renderAll();
            hideAddClient();

            // Clear form
            document.getElementById('client-name').value = '';
            document.getElementById('client-company').value = '';
            document.getElementById('client-phone').value = '';
            document.getElementById('client-email').value = '';
        }

        function deleteClient(id) {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ')) {
                data.clients = data.clients.filter(c => c.id !== id);
                saveData();
                renderAll();
            }
        }

        // ===== FINANCE FUNCTIONS =====
        function showAddIncome() {
            document.getElementById('add-income-form').classList.add('active');
            document.getElementById('add-expense-form').classList.remove('active');
        }

        function hideAddIncome() {
            document.getElementById('add-income-form').classList.remove('active');
        }

        function showAddExpense() {
            document.getElementById('add-expense-form').classList.add('active');
            document.getElementById('add-income-form').classList.remove('active');
        }

        function hideAddExpense() {
            document.getElementById('add-expense-form').classList.remove('active');
        }

        function addIncome() {
            const income = {
                id: 'inc_' + Date.now(),
                desc: document.getElementById('income-desc').value,
                amount: document.getElementById('income-amount').value,
                date: document.getElementById('income-date').value,
                source: document.getElementById('income-source').value
            };

            if (!income.desc || !income.amount) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙˆØµÙ ÙˆØ§Ù„Ù…Ø¨Ù„Øº');
                return;
            }

            data.income.push(income);
            saveData();
            renderAll();
            hideAddIncome();

            // Clear form
            document.getElementById('income-desc').value = '';
            document.getElementById('income-amount').value = '';
            document.getElementById('income-date').value = '';
            document.getElementById('income-source').value = '';
        }

        function addExpense() {
            const expense = {
                id: 'exp_' + Date.now(),
                desc: document.getElementById('expense-desc').value,
                amount: document.getElementById('expense-amount').value,
                date: document.getElementById('expense-date').value,
                category: document.getElementById('expense-category').value
            };

            if (!expense.desc || !expense.amount) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙˆØµÙ ÙˆØ§Ù„Ù…Ø¨Ù„Øº');
                return;
            }

            data.expenses.push(expense);
            saveData();
            renderAll();
            hideAddExpense();

            // Clear form
            document.getElementById('expense-desc').value = '';
            document.getElementById('expense-amount').value = '';
            document.getElementById('expense-date').value = '';
        }

        // ===== CALCULATOR =====
        const rates = {
            excavation: 50,
            concrete: 350,
            blocks: 45,
            plaster: 25,
            tiles: 85,
            paint: 15
        };

        const units = {
            excavation: 'Ù…Â³',
            concrete: 'Ù…Â³',
            blocks: 'Ù…Â²',
            plaster: 'Ù…Â²',
            tiles: 'Ù…Â²',
            paint: 'Ù…Â²'
        };

        function updateCalc() {
            const type = document.getElementById('calc-type').value;
            const length = parseFloat(document.getElementById('calc-length').value) || 0;
            const width = parseFloat(document.getElementById('calc-width').value) || 0;
            const height = parseFloat(document.getElementById('calc-height').value) || 0;

            let quantity;
            if (['excavation', 'concrete'].includes(type)) {
                quantity = length * width * height;
            } else {
                quantity = length * width;
            }

            const cost = quantity * rates[type];

            document.getElementById('calc-quantity').textContent = 
                quantity.toLocaleString() + ' ' + units[type];
            document.getElementById('calc-cost').textContent = 
                cost.toLocaleString() + ' AED';
        }

        function updateProjectEstimate() {
            const type = document.getElementById('proj-type').value;
            const area = parseFloat(document.getElementById('proj-area').value) || 0;
            const finish = document.getElementById('proj-finish').value;

            const baseRates = {
                villa: 1500,
                building: 1200,
                commercial: 1800
            };

            const finishMultiplier = {
                standard: 1,
                luxury: 1.5,
                super: 2
            };

            const estimate = area * baseRates[type] * finishMultiplier[finish];
            document.getElementById('proj-estimate').textContent = 
                estimate.toLocaleString() + ' AED';
        }

        // ===== INIT =====
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            updateCalc();
            updateProjectEstimate();
        });

        // Close modal on outside click
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') closeModal();
        });

        // ===== AI AGENT =====
        const AI_API_URL = '/api/chat';
        let aiMessages = [];

        function toggleAI() {
            const panel = document.getElementById('ai-panel');
            const toggle = document.getElementById('ai-toggle');
            panel.classList.toggle('active');
            toggle.classList.toggle('active');
            
            if (panel.classList.contains('active')) {
                toggle.innerHTML = 'âœ•';
                document.getElementById('ai-input').focus();
                
                // Show welcome message if first time
                if (aiMessages.length === 0) {
                    addAIMessage('agent', `ğŸ—ï¸ QS Empire Agent | Online

â–¸ Status: Operational
â–¸ Mode: Professional Assistant

Capabilities:
â€¢ Quantity calculations & BOQ
â€¢ Cost estimation & pricing
â€¢ Proposal generation
â€¢ Market rate analysis

Enter your request.`);
                }
            } else {
                toggle.innerHTML = 'ğŸ¤–';
            }
        }

        function addAIMessage(type, text) {
            const container = document.getElementById('ai-messages');
            const msg = document.createElement('div');
            msg.className = 'ai-message ' + type;
            msg.textContent = text;
            container.appendChild(msg);
            container.scrollTop = container.scrollHeight;
            aiMessages.push({ type, text });
        }

        function showTyping() {
            const container = document.getElementById('ai-messages');
            const typing = document.createElement('div');
            typing.className = 'ai-message typing';
            typing.id = 'typing-indicator';
            typing.textContent = 'Processing';
            container.appendChild(typing);
            container.scrollTop = container.scrollHeight;
        }

        function hideTyping() {
            const typing = document.getElementById('typing-indicator');
            if (typing) typing.remove();
        }

        async function sendAIMessage() {
            const input = document.getElementById('ai-input');
            const sendBtn = document.getElementById('ai-send');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addAIMessage('user', message);
            input.value = '';
            sendBtn.disabled = true;
            
            // Show typing
            showTyping();
            
            try {
                const response = await fetch(AI_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });
                
                const data = await response.json();
                hideTyping();
                
                if (data.success && data.reply) {
                    addAIMessage('agent', data.reply);
                } else {
                    addAIMessage('agent', 'âš  Processing error. Retry or rephrase request.');
                }
            } catch (error) {
                hideTyping();
                addAIMessage('agent', 'âš  Connection failed. Check network and retry.');
            }
            
            sendBtn.disabled = false;
        }

        function aiQuickAction(action) {
            const input = document.getElementById('ai-input');
            input.value = action;
            sendAIMessage();
        }

        // Enter key to send
        document.getElementById('ai-input')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendAIMessage();
            }
        });
    </script>

    <!-- AI Agent Toggle Button -->
    <button class="ai-toggle" id="ai-toggle" onclick="toggleAI()">ğŸ¤–</button>

    <!-- AI Agent Panel -->
    <div class="ai-panel" id="ai-panel">
        <div class="ai-header">
            <div class="ai-header-icon">ğŸ¤–</div>
            <div class="ai-header-info">
                <h3>QS Empire Agent</h3>
                <span>Professional AI Assistant</span>
            </div>
            <div class="ai-status">
                <div class="ai-status-dot"></div>
                Online
            </div>
        </div>
        
        <div class="ai-messages" id="ai-messages"></div>
        
        <div class="ai-quick-actions">
            <button class="ai-quick-btn" onclick="aiQuickAction('Ø¨Ø­Ø« Ø¹Ù† ÙØ±Øµ Ø¬Ø¯ÙŠØ¯Ø©')">ğŸ” Ø¨Ø­Ø« ÙØ±Øµ</button>
            <button class="ai-quick-btn" onclick="aiQuickAction('Calculate concrete 10x15x0.3')">ğŸ“ Ø­Ø³Ø§Ø¨</button>
            <button class="ai-quick-btn" onclick="aiQuickAction('Ø§ÙƒØªØ¨ proposal Ø§Ø­ØªØ±Ø§ÙÙŠ')">ğŸ“ Proposal</button>
            <button class="ai-quick-btn" onclick="aiQuickAction('Market rates UAE 2025')">ğŸ’° Ø£Ø³Ø¹Ø§Ø±</button>
        </div>
        
        <div class="ai-input-area">
            <textarea class="ai-input" id="ai-input" placeholder="Enter your request..." rows="1"></textarea>
            <button class="ai-send" id="ai-send" onclick="sendAIMessage()">â¤</button>
        </div>
    </div>
</body>
</html>
